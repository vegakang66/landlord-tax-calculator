<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿æ±ç¨…å‹™è©¦ç®—å™¨ - æ˜Ÿé´»å®œè˜­åœ˜éšŠ</title>
    <style>
:root {
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;
  --font-family-base: "PingFang TC", "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;
  --space-4: 4px;
  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;
    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--space-24);
}

.header {
  text-align: center;
  margin-bottom: var(--space-32);
}

.header h1 {
  font-size: var(--font-size-4xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  margin-bottom: var(--space-8);
}

.header p {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
}

.input-section {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  margin-bottom: var(--space-32);
}

.input-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-20);
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-label {
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.form-input,
.form-select {
  width: 100%;
  padding: var(--space-12);
  font-size: var(--font-size-base);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard);
}

.form-input:focus,
.form-select:focus {
  border-color: var(--color-primary);
  outline: none;
  box-shadow: var(--focus-ring);
}

.form-select {
  appearance: none;
  background-image: var(--select-caret-light);
  background-repeat: no-repeat;
  background-position: right var(--space-12) center;
  background-size: 16px;
  padding-right: var(--space-32);
}

@media (prefers-color-scheme: dark) {
  .form-select {
    background-image: var(--select-caret-dark);
  }
}

.subsidy-checkboxes {
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.checkbox-item input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.checkbox-item label {
  font-size: var(--font-size-sm);
  color: var(--color-text);
  cursor: pointer;
}

.subsidy-note {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  margin-top: var(--space-8);
  font-style: italic;
}

.comparison-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--space-20);
  margin-bottom: var(--space-32);
}

.category-card {
  background: var(--color-surface);
  border: 2px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  box-shadow: var(--shadow-sm);
  transition: all var(--duration-normal) var(--ease-standard);
  position: relative;
}

.category-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.category-card.best {
  border-color: var(--color-primary);
  background: var(--color-bg-3);
}

.category-card.risky {
  border-color: var(--color-error);
  background: var(--color-bg-4);
}

.category-header {
  margin-bottom: var(--space-16);
}

.category-title {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.category-desc {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-8);
}

.badge {
  display: inline-block;
  padding: var(--space-4) var(--space-12);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  margin-top: var(--space-8);
}

.badge-best {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.badge-safe {
  background: var(--color-bg-3);
  color: var(--color-success);
  border: 1px solid var(--color-success);
}

.badge-risky {
  background: var(--color-bg-4);
  color: var(--color-error);
  border: 1px solid var(--color-error);
}

.warning-box {
  background: rgba(var(--color-error-rgb), 0.1);
  border: 1px solid var(--color-error);
  border-radius: var(--radius-base);
  padding: var(--space-12);
  margin-top: var(--space-12);
}

.warning-text {
  font-size: var(--font-size-sm);
  color: var(--color-error);
  font-weight: var(--font-weight-medium);
}

.breakdown {
  margin-top: var(--space-16);
  padding-top: var(--space-16);
  border-top: 1px solid var(--color-card-border-inner);
}

.breakdown-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-8) 0;
  font-size: var(--font-size-sm);
}

.breakdown-label {
  color: var(--color-text-secondary);
}

.breakdown-value {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.breakdown-value.positive {
  color: var(--color-success);
}

.breakdown-value.negative {
  color: var(--color-error);
}

.net-income {
  margin-top: var(--space-16);
  padding: var(--space-16);
  background: var(--color-bg-1);
  border-radius: var(--radius-base);
  text-align: center;
}

.net-income-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-4);
}

.net-income-value {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

.empty-state {
  text-align: center;
  padding: var(--space-32);
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
}

.disclaimer {
  background: var(--color-bg-2);
  border: 1px solid rgba(var(--color-warning-rgb), 0.3);
  border-radius: var(--radius-base);
  padding: var(--space-16);
  margin-top: var(--space-32);
}

.disclaimer-title {
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.disclaimer-text {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  line-height: 1.6;
}

@media (max-width: 768px) {
  .container {
    padding: var(--space-16);
  }

  .input-grid {
    grid-template-columns: 1fr;
  }

  .comparison-grid {
    grid-template-columns: 1fr;
  }

  .header h1 {
    font-size: var(--font-size-3xl);
  }

  .net-income-value {
    font-size: var(--font-size-2xl);
  }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ  æˆ¿æ±ç¨…å‹™è©¦ç®—å™¨ - æ˜Ÿé´»å®œè˜­åœ˜éšŠ</h1>
            <p>æ¯”è¼ƒä¸åŒèº«åˆ†åˆ¥çš„ç¨…è² å·®ç•°ï¼Œæ‰¾å‡ºæœ€é©åˆæ‚¨çš„ç§Ÿè³ƒæ–¹æ¡ˆ</p>
        </div>

        <div class="input-section">
            <div class="input-grid">
                <div class="form-group">
                    <label class="form-label" for="monthlyRent">æœˆç§Ÿé‡‘ï¼ˆå…ƒï¼‰</label>
                    <input 
                        type="number" 
                        id="monthlyRent" 
                        class="form-input" 
                        placeholder="è«‹è¼¸å…¥æœˆç§Ÿé‡‘"
                        min="0"
                        step="1000"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="taxBracket">æ‰€å¾—ç¨…ç´šè·</label>
                    <select id="taxBracket" class="form-select">
                        <option value="0.05">5% (59è¬ä»¥ä¸‹)</option>
                        <option value="0.12">12% (133è¬ä»¥ä¸‹)</option>
                        <option value="0.20">20% (266è¬ä»¥ä¸‹)</option>
                        <option value="0.30">30% (498è¬ä»¥ä¸‹)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">ç¤¾æœƒä½å®…è£œåŠ©ï¼ˆåƒ…é©ç”¨æ–¼ç¤¾æœƒä½å®…ï¼‰</label>
                    <div class="subsidy-checkboxes">
                        <div class="checkbox-item">
                            <input type="checkbox" id="renovationSubsidy">
                            <label for="renovationSubsidy">ä¿®ç¹•è£œåŠ©ï¼ˆæœ€é«˜15,000å…ƒ/å¹´ï¼‰</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="insuranceSubsidy">
                            <label for="insuranceSubsidy">å±…å®¶å®‰å…¨éšªï¼ˆ3,500å…ƒ/å¹´ï¼‰</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="notarizationSubsidy">
                            <label for="notarizationSubsidy">å…¬è­‰è²»è£œåŠ©ï¼ˆ3,000å…ƒ/å¹´ï¼‰</label>
                        </div>
                    </div>
                    <div class="subsidy-note">â€» é€™äº›è£œåŠ©åƒ…é©ç”¨æ–¼ã€Œç¤¾æœƒä½å®…åŒ…ç§Ÿä»£ç®¡ã€æ–¹æ¡ˆ</div>
                </div>
            </div>
        </div>

        <div id="results" class="comparison-grid">
            <div class="empty-state">è«‹è¼¸å…¥æœˆç§Ÿé‡‘ä»¥æŸ¥çœ‹ç¨…å‹™è©¦ç®—çµæœ</div>
        </div>

        <div class="disclaimer">
            <div class="disclaimer-title">ğŸ“Œ å…è²¬è²æ˜</div>
            <div class="disclaimer-text">
                â€¢ æœ¬è©¦ç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›ç¨…å‹™æ‡‰ä»¥å„åœ°ç¨…æç¨½å¾µè™•å…¬å‘Šç‚ºæº–<br>
                â€¢ æˆ¿å±‹ç¨…+åœ°åƒ¹ç¨…åƒ…ç‚ºå„ªæƒ å·®ç•°è©¦ç®—ï¼Œè¦–ç‰©ä»¶æƒ…æ³è€Œç•°<br>
                â€¢ æ‰€å¾—ç¨…ç´šè·éœ€æ ¹æ“šå€‹äººå¯¦éš›æ‰€å¾—æƒ…æ³é¸æ“‡<br>
                â€¢ ç¤¾æœƒä½å®…è£œåŠ©é …ç›®ä»¥æ”¿åºœæœ€æ–°å…¬å‘Šç‚ºæº–<br>
                â€¢ å»ºè­°è«®è©¢ç¨…å‹™å°ˆå®¶æˆ–æœƒè¨ˆå¸«ä»¥ç²å¾—æ­£ç¢ºçš„ç¨…å‹™è¦åŠƒ
            </div>
        </div>
    </div>

    <script>
        // Get DOM elements
        const monthlyRentInput = document.getElementById('monthlyRent');
        const taxBracketSelect = document.getElementById('taxBracket');
        const renovationSubsidyCheckbox = document.getElementById('renovationSubsidy');
        const insuranceSubsidyCheckbox = document.getElementById('insuranceSubsidy');
        const notarizationSubsidyCheckbox = document.getElementById('notarizationSubsidy');
        const resultsContainer = document.getElementById('results');

        // Format number with thousand separator
        function formatNumber(num) {
            return Math.round(num).toLocaleString('zh-TW');
        }

        // Calculate taxes for all categories
        function calculateTaxes() {
            const monthlyRent = parseFloat(monthlyRentInput.value) || 0;
            const taxRate = parseFloat(taxBracketSelect.value);

            if (monthlyRent <= 0) {
                resultsContainer.innerHTML = '<div class="empty-state">è«‹è¼¸å…¥æœˆç§Ÿé‡‘ä»¥æŸ¥çœ‹ç¨…å‹™è©¦ç®—çµæœ</div>';
                return;
            }

            const annualRent = monthlyRent * 12;

            // Category 1: No Tax Filing (ä¸å ±ç¨…)
            const propertyLandTax1 = annualRent * 0.05;
            const category1 = {
                id: 1,
                name: 'ä¸å ±ç¨…',
                description: 'è‡ªè¡Œå‡ºç§Ÿã€æœªç”³å ±ç§Ÿé‡‘æ”¶å…¥',
                risk: 'risky',
                badge: 'é«˜é¢¨éšª',
                annualRent: annualRent,
                taxFree: 0,
                taxableIncome: 0,
                incomeTax: 0,
                propertyLandTax: propertyLandTax1,
                propertyTaxRate: '5% (ä¸€èˆ¬å‡ºç§Ÿç¨…ç‡)',
                subsidies: 0,
                netIncome: annualRent - propertyLandTax1
            };

            // Category 2: General Tax Filing (ä¸€èˆ¬å ±ç¨…)
            const propertyLandTax2 = annualRent * 0.05;
            const category2 = {
                id: 2,
                name: 'ä¸€èˆ¬å ±ç¨…',
                description: 'è‡ªè¡Œå‡ºç§Ÿã€åˆæ³•å ±ç¨…',
                risk: 'safe',
                badge: 'å®‰å…¨',
                annualRent: annualRent,
                taxFree: 0,
                taxableIncome: annualRent,
                necessaryExpense: 0,
                incomeTax: annualRent * taxRate,
                propertyLandTax: propertyLandTax2,
                propertyTaxRate: '5% (ä¸€èˆ¬å‡ºç§Ÿç¨…ç‡)',
                subsidies: 0,
                netIncome: annualRent - (annualRent * taxRate) - propertyLandTax2
            };

            // Category 3: Public Interest Lessor (å…¬ç›Šå‡ºç§Ÿäºº)
            const monthlyTaxFree3 = 15000;
            const annualTaxFree3 = monthlyTaxFree3 * 12;
            const taxableIncome3 = Math.max(0, annualRent - annualTaxFree3);
            const necessaryExpense3 = taxableIncome3 * 0.43;
            const incomeTax3 = (taxableIncome3 - necessaryExpense3) * taxRate;
            const propertyLandTax3 = annualRent * 0.012;
            
            const category3 = {
                id: 3,
                name: 'å…¬ç›Šå‡ºç§Ÿäºº',
                description: 'ç§Ÿå®¢æœ‰ç”³è«‹ç§Ÿé‡‘è£œè²¼',
                risk: 'safe',
                badge: 'å®‰å…¨',
                annualRent: annualRent,
                taxFree: annualTaxFree3,
                taxableIncome: taxableIncome3,
                necessaryExpense: necessaryExpense3,
                incomeTax: incomeTax3,
                propertyLandTax: propertyLandTax3,
                propertyTaxRate: '1.2% (è‡ªç”¨ä½å®…ç¨…ç‡)',
                subsidies: 0,
                netIncome: annualRent - incomeTax3 - propertyLandTax3
            };

            // Category 4: Social Housing (ç¤¾æœƒä½å®…)
            const monthlyTaxFree4 = 15000;
            const annualTaxFree4 = monthlyTaxFree4 * 12;
            const taxableIncome4 = Math.max(0, annualRent - annualTaxFree4);
            const necessaryExpense4 = taxableIncome4 * 0.6;
            const incomeTax4 = (taxableIncome4 - necessaryExpense4) * taxRate;
            const propertyLandTax4 = annualRent * 0.012;
            
            // Calculate subsidies
            let totalSubsidies = 0;
            if (renovationSubsidyCheckbox.checked) totalSubsidies += 15000;
            if (insuranceSubsidyCheckbox.checked) totalSubsidies += 3500;
            if (notarizationSubsidyCheckbox.checked) totalSubsidies += 3000;
            
            const category4 = {
                id: 4,
                name: 'ç¤¾æœƒä½å®…',
                description: 'æ”¿åºœå§”è¨—ã€æœ€é«˜ç¨…å„ª',
                risk: 'best',
                badge: 'æœ€åˆ’ç®—',
                annualRent: annualRent,
                taxFree: annualTaxFree4,
                taxableIncome: taxableIncome4,
                necessaryExpense: necessaryExpense4,
                incomeTax: incomeTax4,
                propertyLandTax: propertyLandTax4,
                propertyTaxRate: '1.2% (è‡ªç”¨ä½å®…ç¨…ç‡)',
                subsidies: totalSubsidies,
                netIncome: annualRent - incomeTax4 - propertyLandTax4 + totalSubsidies
            };

            // Render all categories
            const categories = [category1, category2, category3, category4];
            renderCategories(categories);
        }

        function renderCategories(categories) {
            const comparisonHTML = categories.map(cat => {
                let badgeClass = 'badge-safe';
                let cardClass = '';
                
                if (cat.risk === 'best') {
                    badgeClass = 'badge-best';
                    cardClass = 'best';
                } else if (cat.risk === 'risky') {
                    badgeClass = 'badge-risky';
                    cardClass = 'risky';
                }

                let html = `
                    <div class="category-card ${cardClass}">
                        <div class="category-header">
                            <div class="category-title">${cat.id}ï¸âƒ£ ${cat.name}</div>
                            <div class="category-desc">${cat.description}</div>
                            <span class="badge ${badgeClass}">${cat.badge}</span>
                        </div>
                `;

                // Special warning for category 1
                // Special warning and penalty breakdown for category 1
                if (cat.id === 1) {
                    // 5å¹´æ¼ç¨…é‡‘é¡
                    const lookbackYears = 5;
                    const penaltyMultiplier = 3;
                    const rent5Years = cat.annualRent * lookbackYears;
                    const taxRate = parseFloat(taxBracketSelect.value);
                    const penaltyTax = rent5Years * taxRate;
                    const penaltyFine = penaltyTax * penaltyMultiplier;
                    const penaltyTotal = penaltyTax + penaltyFine;

                    html += `
                        <div class="warning-box">
                            <div class="warning-text">âš ï¸ è¢«æŸ¥åˆ°æœƒç½°æ¬¾ï¼ˆå¾€å‰è¿½æº¯5å¹´ï¼‰</div>
                            <div class="breakdown">
                                <div class="breakdown-item">
                                    <span class="breakdown-label">5å¹´æ¼ç¨…é‡‘é¡</span>
                                    <span class="breakdown-value">NT$ ${formatNumber(rent5Years)}</span>
                                </div>
                                <div class="breakdown-item">
                                    <span class="breakdown-label">æ‡‰ç´ç¨…é¡</span>
                                    <span class="breakdown-value negative">NT$ ${formatNumber(penaltyTax)}</span>
                                </div>
                                <div class="breakdown-item">
                                    <span class="breakdown-label">ç½°æ¬¾ï¼ˆ3å€ï¼‰</span>
                                    <span class="breakdown-value negative">NT$ ${formatNumber(penaltyFine)}</span>
                                </div>
                                <div class="breakdown-item">
                                    <span class="breakdown-label">åˆè¨ˆç½°æ¬¾</span>
                                    <span class="breakdown-value negative">NT$ ${formatNumber(penaltyTotal)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                html += `
                    <div class="breakdown">
                        <div class="breakdown-item">
                            <span class="breakdown-label">å¹´ç§Ÿé‡‘</span>
                            <span class="breakdown-value">NT$ ${formatNumber(cat.annualRent)}</span>
                        </div>
                `;



                if (cat.id === 3 || cat.id === 4) {
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-label">å…ç¨…é¡</span>
                            <span class="breakdown-value positive">NT$ ${formatNumber(cat.taxFree)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">æ‡‰ç¨…æ‰€å¾—</span>
                            <span class="breakdown-value">NT$ ${formatNumber(cat.taxableIncome)}</span>
                        </div>
                    `;
                } else if (cat.id !== 1) {
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-label">æ‡‰ç¨…æ‰€å¾—</span>
                            <span class="breakdown-value">NT$ ${formatNumber(cat.taxableIncome)}</span>
                        </div>
                    `;
                }

                if ((cat.id === 3 || cat.id === 4) && cat.necessaryExpense > 0) {
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-label">å¿…è¦è²»ç”¨æ‰£é™¤ç‡${cat.id === 3 ? ' 43%' : ' 60%'}</span>
                            <span class="breakdown-value positive">NT$ ${formatNumber(cat.necessaryExpense)}</span>
                        </div>
                    `;
                }

                if (cat.id !== 1) {
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-label">æ‰€å¾—ç¨…</span>
                            <span class="breakdown-value negative">NT$ ${formatNumber(cat.incomeTax)}</span>
                        </div>
                    `;
                }

                if (cat.propertyLandTax !== undefined) {
                    const taxRateLabel = cat.propertyTaxRate ? ` <small style='color: var(--color-text-secondary); font-size: var(--font-size-xs);'>${cat.propertyTaxRate === '1.2% (è‡ªç”¨ä½å®…ç¨…ç‡)' ? 'è‡ªç”¨ä½å®…å„ªæƒ ç¨…ç‡' : 'ä¸€èˆ¬å‡ºç§Ÿéè‡ªä½ç¨…ç‡'}</small>` : '';
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-label">æˆ¿å±‹ç¨…+åœ°åƒ¹ç¨…${taxRateLabel}</span>
                            <span class="breakdown-value negative">NT$ ${formatNumber(cat.propertyLandTax)}</span>
                        </div>
                    `;
                }

                if (cat.id === 4 && cat.subsidies > 0) {
                    html += `
                        <div class="breakdown-item">
                            <span class="breakdown-label">æ”¿åºœè£œåŠ©</span>
                            <span class="breakdown-value positive">NT$ ${formatNumber(cat.subsidies)}</span>
                        </div>
                    `;
                }

                html += `
                    </div>
                    <div class="net-income">
                        <div class="net-income-label">å¹´æ·¨æ”¶å…¥</div>
                        <div class="net-income-value">NT$ ${formatNumber(cat.netIncome)}</div>
                    </div>
                </div>
                `;

                return html;
            }).join('');
            
            resultsContainer.innerHTML = comparisonHTML;
        }

        // Event listeners for real-time calculation
        monthlyRentInput.addEventListener('input', calculateTaxes);
        taxBracketSelect.addEventListener('change', calculateTaxes);
        renovationSubsidyCheckbox.addEventListener('change', calculateTaxes);
        insuranceSubsidyCheckbox.addEventListener('change', calculateTaxes);
        notarizationSubsidyCheckbox.addEventListener('change', calculateTaxes);

        // Initial calculation
        calculateTaxes();
    </script>
</body>
</html>
